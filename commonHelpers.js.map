{"version":3,"file":"commonHelpers.js","sources":["../src/index.js"],"sourcesContent":["import axios from 'axios';\n\nimport SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\n\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n//встановили бібліотеку спінер джс\nimport { Spinner } from 'spin.js';\n\n// const input = document.querySelector('.search-input');\nconst form = document.querySelector('.js-search-form');\nconst searchBtn = document.querySelector('.search-btn');\nconst gallery = document.querySelector('.js-gallery');\n\nform.addEventListener('submit', onSearchClick);\n\nlet searchQuery = null;\nlet page = 1;\nconst perPage = 12;\n\naxios.defaults.baseURL = 'https://api.unsplash.com';\naxios.defaults.headers.common['Authorization'] =\n  'Client-ID LxvKVGJqiSe6NcEVZOaLXC-f2JIIWZaq_o0WrF8mwJc';\n\nconst simplelightbox = new SimpleLightbox('.gallery a', {\n  captions: true,\n  captionsData: 'alt',\n  captionDelay: 250,\n});\n\nfunction getPhotos(query, page = 1, perPage) {\n  return axios.get('/search/photos', {\n    params: {\n      page,\n      query,\n      orientation: 'portrait',\n      per_page: perPage,\n    },\n  });\n}\n///////////////////////SPINNER/////////////////////////\n\nconst opts = {\n  lines: 17, // The number of lines to draw\n  length: 33, // The length of each line\n  width: 52, // The line thickness\n  radius: 14, // The radius of the inner circle\n  scale: 1, // Scales overall size of the spinner\n  corners: 1, // Corner roundness (0..1)\n  speed: 1.6, // Rounds per second\n  rotate: 0, // The rotation offset\n  animation: 'spinner-line-fade-quick', // The CSS animation name for the lines\n  direction: 1, // 1: clockwise, -1: counterclockwise\n  color: '#7f9083', // CSS color or array of colors\n  fadeColor: 'transparent', // CSS color or array of colors\n  top: '50%', // Top position relative to parent\n  left: '49%', // Left position relative to parent\n  shadow: '0 0 1px transparent', // Box-shadow for the lines\n  zIndex: 2000000000, // The z-index (defaults to 2e9)\n  className: 'spinner', // The CSS class to assign to the spinner\n  position: 'absolute', // Element positioning\n};\nconst spinerContainer = document.querySelector('.js-backdrop');\nconst spinner = new Spinner(opts);\n//активуємо спінер\n// spinner.spin(spinerContainer); // ( в дужках на чому повинен крутитися)\n\n///////////////////////SPINNER/////////////////////////\n\n/////////////////////////OBSERVER//////////////\n\nconst options = {\n  root: null,\n  rootMargin: '100px',\n  threshold: 1.0,\n};\n\nconst callback = function (entries, observer) {\n  entries.forEach(entry => {\n    if (entry.isIntersecting) {\n      observer.unobserve(entry.target);\n      loadMoreData();\n    }\n  });\n};\n\nconst observer = new IntersectionObserver(callback, options);\n\n////////////////////OBSERVER/////////////////////\n\nasync function onSearchClick(evt) {\n  evt.preventDefault();\n  spinnerPlay();\n  const form = evt.currentTarget;\n  searchQuery = form.elements['user-search-query'].value.trim();\n  page = 1; // кожен новий запит на нові картинки починається з 1 ст\n  //коли йде запит на сервер може статися помилка тому це потрібно вірно обробити\n  try {\n    //   const response = await getPhotos(query) --- витягли з респонсу дату і потім масив результату\n    const {\n      data: { results, total_pages },\n    } = await getPhotos(searchQuery, page, perPage);\n    console.log(results);\n    if (!results.length) {\n      iziToast.warning({\n        title: 'Caution',\n        message: 'Please enter something for search',\n      });\n    }\n\n    gallery.innerHTML = createMarkup(results);\n    hasMoreData(total_pages);\n    simplelightbox.refresh();\n  } catch (err) {\n    console.log(err);\n  } finally {\n    form.reset();\n    spinnerStop();\n  }\n}\n\n//безкінечний скрол\nasync function loadMoreData() {\n  page += 1;\n  spinnerPlay();\n  try {\n    const {\n      data: { results, total_pages },\n    } = await getPhotos(searchQuery, page, perPage);\n\n    gallery.insertAdjacentHTML('beforeend', createMarkup(results));\n    hasMoreData(total_pages);\n    simplelightbox.refresh();\n  } catch (err) {\n    console.log(err);\n  } finally {\n    spinnerStop();\n  }\n}\nfunction createMarkup(arr) {\n  return arr\n    .map(\n      ({\n        alt_description,\n        urls: { small, full },\n      }) => `   <li class=\"gallery-item\" >\n      <a class=\"gallery-img\" href=\"${full}\" target='blank'>\n        <img src=\"${small}\" alt=\"${alt_description}\" />\n      </a>\n    </li>`\n    )\n    .join('');\n}\n\nfunction spinnerPlay() {\n  spinner.spin(spinerContainer);\n  spinerContainer.classList.remove('is-hidden');\n}\nfunction spinnerStop() {\n  spinner.stop();\n  spinerContainer.classList.add('is-hidden');\n}\nfunction hasMoreData(lastPage) {\n  if (page < lastPage) {\n    //то слідкуємо далі за останнім елем\n    const lastArrItem = document.querySelector('.gallery-item:last-child');\n    observer.observe(lastArrItem);\n  } else {\n    iziToast.error({\n      title: 'Caution',\n      message: 'Sorry but it`s the last pictures in our server',\n    });\n  }\n}\n"],"names":["form","gallery","onSearchClick","searchQuery","page","perPage","axios","simplelightbox","SimpleLightbox","getPhotos","query","opts","spinerContainer","spinner","Spinner","options","callback","entries","observer","entry","loadMoreData","evt","spinnerPlay","results","total_pages","iziToast","createMarkup","hasMoreData","err","spinnerStop","arr","alt_description","small","full","lastPage","lastArrItem"],"mappings":"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"}